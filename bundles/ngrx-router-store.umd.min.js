!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngrx/store"),require("@angular/core"),require("@angular/router"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngrx/router-store",["exports","@ngrx/store","@angular/core","@angular/router","rxjs/operators"],e):e(((t=t||self).ngrx=t.ngrx||{},t.ngrx["router-store"]={}),t.store,t.ng.core,t.ng.router,t.rxjs.operators)}(this,(function(t,e,r,o,i){"use strict";var n=e.createAction("@ngrx/router-store/request",e.props()),a="@ngrx/router-store/navigation",u=e.createAction(a,e.props()),s="@ngrx/router-store/cancel",c=e.createAction(s,e.props()),l="@ngrx/router-store/error",p=e.createAction(l,e.props()),f=e.createAction("@ngrx/router-store/navigated",e.props());var g=function(){};var h=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map((function(t){return e.serializeRoute(t)}));return{params:t.params,paramMap:t.paramMap,data:t.data,url:t.url,outlet:t.outlet,routeConfig:t.routeConfig?{component:t.routeConfig.component,path:t.routeConfig.path,pathMatch:t.routeConfig.pathMatch,redirectTo:t.routeConfig.redirectTo,outlet:t.routeConfig.outlet}:null,queryParams:t.queryParams,queryParamMap:t.queryParamMap,fragment:t.fragment,component:t.routeConfig?t.routeConfig.component:void 0,root:void 0,parent:void 0,firstChild:r[0],pathFromRoot:void 0,children:r}},t}();var d=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map((function(t){return e.serializeRoute(t)}));return{params:t.params,data:t.data,url:t.url,outlet:t.outlet,routeConfig:t.routeConfig?{path:t.routeConfig.path,pathMatch:t.routeConfig.pathMatch,redirectTo:t.routeConfig.redirectTo,outlet:t.routeConfig.outlet}:null,queryParams:t.queryParams,fragment:t.fragment,firstChild:r[0],children:r}},t}(),v=this&&this.__assign||function(){return(v=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},R=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,i,n=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)a.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return a};var y={PreActivation:1,PostActivation:2};y[y.PreActivation]="PreActivation",y[y.PostActivation]="PostActivation";var S=new r.InjectionToken("@ngrx/router-store Internal Configuration"),E=new r.InjectionToken("@ngrx/router-store Configuration");function m(t){return v({stateKey:"router",serializer:d,navigationActionTiming:y.PreActivation},t)}var A={NONE:1,ROUTER:2,STORE:3};A[A.NONE]="NONE",A[A.ROUTER]="ROUTER",A[A.STORE]="STORE";var N=function(){function t(t,e,r,o,i){this.store=t,this.router=e,this.serializer=r,this.errorHandler=o,this.config=i,this.lastEvent=null,this.routerState=null,this.trigger=A.NONE,this.stateKey=this.config.stateKey,this.setUpStoreStateListener(),this.setUpRouterEventsListener()}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:S,useValue:e},{provide:E,useFactory:m,deps:[S]},{provide:g,useClass:e.serializer?e.serializer:0===e.routerState?h:d}]}},t.prototype.setUpStoreStateListener=function(){var t=this;this.store.pipe(e.select(this.stateKey),i.withLatestFrom(this.store)).subscribe((function(e){var r=R(e,2),o=r[0],i=r[1];t.navigateIfNeeded(o,i)}))},t.prototype.navigateIfNeeded=function(t,e){var r=this;if(t&&t.state&&this.trigger!==A.ROUTER&&!(this.lastEvent instanceof o.NavigationStart)){var i=t.state.url;this.router.url!==i&&(this.storeState=e,this.trigger=A.STORE,this.router.navigateByUrl(i).catch((function(t){r.errorHandler.handleError(t)})))}},t.prototype.setUpRouterEventsListener=function(){var t,e=this,r=this.config.navigationActionTiming===y.PostActivation;this.router.events.pipe(i.withLatestFrom(this.store)).subscribe((function(i){var n=R(i,2),a=n[0],u=n[1];e.lastEvent=a,a instanceof o.NavigationStart?(e.routerState=e.serializer.serialize(e.router.routerState.snapshot),e.trigger!==A.STORE&&(e.storeState=u,e.dispatchRouterRequest(a))):a instanceof o.RoutesRecognized?(t=a,r||e.trigger===A.STORE||e.dispatchRouterNavigation(a)):a instanceof o.NavigationCancel?(e.dispatchRouterCancel(a),e.reset()):a instanceof o.NavigationError?(e.dispatchRouterError(a),e.reset()):a instanceof o.NavigationEnd&&(e.trigger!==A.STORE&&(r&&e.dispatchRouterNavigation(t),e.dispatchRouterNavigated(a)),e.reset())}))},t.prototype.dispatchRouterRequest=function(t){this.dispatchRouterAction("@ngrx/router-store/request",{event:t})},t.prototype.dispatchRouterNavigation=function(t){var e=this.serializer.serialize(t.state);this.dispatchRouterAction(a,{routerState:e,event:new o.RoutesRecognized(t.id,t.url,t.urlAfterRedirects,e)})},t.prototype.dispatchRouterCancel=function(t){this.dispatchRouterAction(s,{storeState:this.storeState,event:t})},t.prototype.dispatchRouterError=function(t){this.dispatchRouterAction(l,{storeState:this.storeState,event:new o.NavigationError(t.id,t.url,""+t)})},t.prototype.dispatchRouterNavigated=function(t){var e=this.serializer.serialize(this.router.routerState.snapshot);this.dispatchRouterAction("@ngrx/router-store/navigated",{event:t,routerState:e})},t.prototype.dispatchRouterAction=function(t,e){this.trigger=A.ROUTER;try{this.store.dispatch({type:t,payload:v(v({routerState:this.routerState},e),{event:0===this.config.routerState?e.event:{id:e.event.id,url:e.event.url}})})}finally{this.trigger=A.NONE}},t.prototype.reset=function(){this.trigger=A.NONE,this.storeState=null,this.routerState=null},t.decorators=[{type:r.NgModule,args:[{}]}],t.ctorParameters=function(){return[{type:e.Store},{type:o.Router},{type:g},{type:r.ErrorHandler},{type:void 0,decorators:[{type:r.Inject,args:[E]}]}]},t}();t.DEFAULT_ROUTER_FEATURENAME="router",t.DefaultRouterStateSerializer=h,t.MinimalRouterStateSerializer=d,t.NavigationActionTiming=y,t.ROUTER_CANCEL=s,t.ROUTER_CONFIG=E,t.ROUTER_ERROR=l,t.ROUTER_NAVIGATED="@ngrx/router-store/navigated",t.ROUTER_NAVIGATION=a,t.ROUTER_REQUEST="@ngrx/router-store/request",t.RouterStateSerializer=g,t.StoreRouterConnectingModule=N,t.getSelectors=function(t){var r=e.createSelector(t,(function(t){return t&&t.state})),o=e.createSelector(r,(function(t){if(t){for(var e=t.root;e.firstChild;)e=e.firstChild;return e}})),i=e.createSelector(o,(function(t){return t&&t.fragment})),n=e.createSelector(o,(function(t){return t&&t.queryParams})),a=e.createSelector(o,(function(t){return t&&t.params})),u=e.createSelector(o,(function(t){return t&&t.data})),s=e.createSelector(r,(function(t){return t&&t.url}));return{selectCurrentRoute:o,selectFragment:i,selectQueryParams:n,selectQueryParam:function(t){return e.createSelector(n,(function(e){return e&&e[t]}))},selectRouteParams:a,selectRouteParam:function(t){return e.createSelector(a,(function(e){return e&&e[t]}))},selectRouteData:u,selectUrl:s}},t.routerCancelAction=c,t.routerErrorAction=p,t.routerNavigatedAction=f,t.routerNavigationAction=u,t.routerReducer=function(t,e){var r=e;switch(r.type){case a:case l:case s:return{state:r.payload.routerState,navigationId:r.payload.event.id};default:return t}},t.routerRequestAction=n,t.ɵa=S,t.ɵb=m,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngrx-router-store.umd.min.js.map